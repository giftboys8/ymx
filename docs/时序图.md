sequenceDiagram
    %% ========== 参与者定义 ==========
    actor 客户 as 客户
    participant 生产计划 as 生产计划
    participant 采购 as 原料采购
    participant 仓库 as 物料入库
    participant 生产 as 生产工序
    participant 质检 as 质检管理
    participant A as 委外加工
    participant 权限 as 权限系统
    participant 出货 as 出货管理
    participant 报告 as 生产报告

    %% ========== 核心流程时序 ==========
    客户 ->> 生产计划: 提交需求
    权限 ->> 生产计划: 校验权限（需求创建）
    生产计划 ->> 采购: 生成采购订单
    权限 ->> 采购: 校验权限（订单审批）
    采购 ->> 仓库: 物料到货
    仓库 ->> 质检: 发起IQC检验
    质检 -->> 仓库: 返回检验结果
    alt 检验通过
        仓库 ->> 生产: 供应物料
    else 检验不通过
        仓库 ->> 采购: 触发退货
    end

    %% ========== 生产工序时序 ==========
    生产 ->> 生产: 生成工序准备
    权限 ->> 生产: 校验权限（设备调试）
    生产 ->> 质检: 发起IPQC检验
    质检 -->> 生产: 返回首件结果
    loop 批量生产
        生产 ->> 质检: 过程抽检
        质检 -->> 生产: 反馈结果
    end
    生产 ->> 仓库: 成品入库
    仓库 ->> 质检: 发起OQC检验
    质检 -->> 仓库: 返回检验结果

    %% ========== 委外加工时序（可选） ==========
    opt 委外加工分支
        生产计划 ->> 委外: 发起委外订单
        委外 ->> 质检: 半成品验收
        质检 -->> 委外: 返回结果
        委外 ->> 生产: 返回加工件
    end

    %% ========== 出货时序 ==========
    仓库 ->> 出货: 可出货成品
    权限 ->> 出货: 校验权限（物流对接）
    出货 ->> 客户: 发货并签收
    客户 -->> 报告: 反馈签收状态
    报告 ->> 生产计划: 闭环生产报告
